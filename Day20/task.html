<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            background-color: #f8f9fa;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .nav-menu li {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-menu li:hover {
            background-color: #e9ecef;
        }

        .nav-menu li.active {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            border-radius: 3px;
        }

        button {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .performance-lists {
            display: flex;
            gap: 20px;
        }

        .performance-list {
            flex: 1;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .clone-container {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
        }

        .clone-item {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
        }

        #observer-target {
            padding: 15px;
            border: 2px dashed #007bff;
            margin: 10px 0;
        }

        #observer-log {
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        mark {
            background-color: #ffd700;
            padding: 2px 4px;
            border-radius: 2px;
        }
    </style>
    <title>DOM Manipulation Examples</title>
</head>

<body>
    <div class="container">
        <!-- Task 1: Navigation Menu -->
        <div class="section">
            <h2>1. Navigation Menu</h2>
            <ul class="nav-menu">
                <li>Home</li>
                <li>About</li>
                <li>Services</li>
                <li>Contact</li>
            </ul>
        </div>

        <!-- Task 2: Text Highlighter -->
        <div class="section">
            <h2>2. Text Highlighter</h2>
            <p id="highlight-text">This is a sample paragraph. Try selecting any portion of this text to highlight it
                using the Range API.</p>
            <button id="highlight-btn">Highlight Selection</button>
        </div>

        <!-- Task 3: Performance Comparison -->
        <div class="section">
            <h2>3. Performance Comparison</h2>
            <button id="add-regular">Add Items (Regular)</button>
            <button id="add-fragment">Add Items (Fragment)</button>
            <div class="performance-lists">
                <div id="regular-list" class="performance-list">
                    <h3>Regular DOM</h3>
                </div>
                <div id="fragment-list" class="performance-list">
                    <h3>Document Fragment</h3>
                </div>
            </div>
        </div>

        <!-- Task 4: Smart Cloner -->
        <div class="section">
            <h2>4. Smart Cloner</h2>
            <div class="clone-container">
                <div id="original" class="clone-item">
                    Original Element
                    <span>With nested content</span>
                </div>
                <button id="clone-deep">Clone Deep</button>
                <button id="clone-shallow">Clone Shallow</button>
                <div id="clones"></div>
            </div>
        </div>

        <!-- Task 5: MutationObserver -->
        <div class="section">
            <h2>5. MutationObserver</h2>
            <div id="observer-target">
                Observed Element
            </div>
            <button id="add-child">Add Child</button>
            <button id="change-class">Toggle Class</button>
            <button id="modify-text">Modify Text</button>
            <div id="observer-log"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {//loadDOM before implimentimg inner program
            // Task 1: Navigation Menu
            const listItems = document.querySelectorAll('.nav-menu li'); //select all <li> element in .nav-menu and return a Nodelist
            listItems.forEach(item => {
                item.addEventListener('click', function () {
                    const parentUl = this.closest('ul');
                    const allLi = parentUl.querySelectorAll('li');
                    allLi.forEach(li => li.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            listItems[0].classList.add('active');//default the 1st <li> as active

            // Task 2: Text Highlighter
            const highlightBtn = document.getElementById('highlight-btn');
            highlightBtn.addEventListener('click', () => {
                const selection = window.getSelection();
                if (!selection.isCollapsed) {//if the user selects
                    const range = selection.getRangeAt(0);//select the 1st range
                    const mark = document.createElement('mark'); //create a new element:<mark>
                    range.surroundContents(mark);//put the selected range into <mark>
                    selection.removeAllRanges();
                }
            });

            // Task 3: Performance Comparison
            const addRegularBtn = document.getElementById('add-regular');
            const addFragmentBtn = document.getElementById('add-fragment');
            const regularList = document.getElementById('regular-list');
            const fragmentList = document.getElementById('fragment-list');

            addRegularBtn.addEventListener('click', () => {
                console.time('Regular DOM');
                for (let i = 0; i < 100; i++) {
                    const li = document.createElement('div');
                    li.textContent = `Item ${i + 1}`;
                    regularList.appendChild(li);
                }
                console.timeEnd('Regular DOM');
            });

            addFragmentBtn.addEventListener('click', () => {
                console.time('Document Fragment');
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < 100; i++) {
                    const li = document.createElement('div');
                    li.textContent = `Item ${i + 1}`;
                    fragment.appendChild(li);
                }
                fragmentList.appendChild(fragment);
                console.timeEnd('Document Fragment');
            });
            /*+----------------------------+----------------------+--------------------------+------------+
            |          Method           | DOM Operation Count  | Reflow/Repaint Count     | Performance|
            +----------------------------+----------------------+--------------------------+------------+
            | Direct appendChild        | 100 times            |           100 times      | Slow       |
            | Using DocumentFragment    |100 times(in memory)+1 DOM|       1 time         | Fast       |
            +----------------------------+----------------------+--------------------------+------------+
            */
            // Task 4: Smart Cloner
            const cloneDeepBtn = document.getElementById('clone-deep');//è¤‡è£½æ•´å€‹åŽŸå§‹å…ƒç´ ï¼ˆåŒ…å«å­å…ƒç´ ï¼‰ä¸¦é¡¯ç¤º
            const cloneShallowBtn = document.getElementById('clone-shallow');//åªè¤‡è£½åŽŸå§‹å…ƒç´ æœ¬èº«ï¼ˆä¸åŒ…å«å­å…ƒç´ ï¼‰ä¸¦é¡¯ç¤º
            const original = document.getElementById('original');
            const clonesContainer = document.getElementById('clones');

            cloneDeepBtn.addEventListener('click', () => {
                const clone = original.cloneNode(true);//æ·±å±¤è¤‡è£½ï¼šåŒ…å«æ‰€æœ‰å­ç¯€é»ž
                clone.id = '';//æ¸…é™¤ idï¼Œé¿å…é‡è¤‡
                clone.style.backgroundColor = '#e9ecef';//æ”¹è®ŠèƒŒæ™¯è‰²ä»¥å€åˆ†
                clone.prepend('Deep Clone: ');//åœ¨æœ€å‰é¢æ’å…¥æ–‡å­—
                clonesContainer.appendChild(clone);//åŠ å…¥åˆ°å®¹å™¨ä¸­
            });

            cloneShallowBtn.addEventListener('click', () => {
                const clone = original.cloneNode(false);
                clone.id = '';// æ¸…é™¤ id
                clone.style.backgroundColor = '#f8d7da';
                clone.textContent = 'Shallow Clone (no children)';// ç›´æŽ¥è¨­å®šæ–‡å­—å…§å®¹
                clonesContainer.appendChild(clone);//åŠ å…¥åˆ°å®¹å™¨ä¸­
            });

            // Task 5: MutationObserver
            // å–å¾—è¦ç›£æŽ§çš„ç›®æ¨™å…ƒç´ 
            const observerTarget = document.getElementById('observer-target');

            // å–å¾—ç”¨ä¾†é¡¯ç¤ºè®ŠåŒ–ç´€éŒ„çš„å®¹å™¨
            const observerLog = document.getElementById('observer-log');

            // ä¸‰å€‹æŒ‰éˆ•ï¼šæ–°å¢žå­ç¯€é»žã€è®Šæ›´ classã€ä¿®æ”¹æ–‡å­—
            const addChildBtn = document.getElementById('add-child');
            const changeClassBtn = document.getElementById('change-class');
            const modifyTextBtn = document.getElementById('modify-text');


            // å»ºç«‹ MutationObserverï¼Œç›£è½ DOM è®ŠåŒ–
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    const log = document.createElement('div'); // å»ºç«‹ä¸€å€‹ log å…ƒç´ 

                    // æ ¹æ“šè®ŠåŒ–é¡žåž‹åˆ†é¡žè™•ç†
                    switch (mutation.type) {
                        case 'childList': // å­ç¯€é»žæ–°å¢žæˆ–ç§»é™¤
                            if (mutation.addedNodes.length > 0) {
                                log.textContent = 'âž• Child node added';
                            }
                            break;
                        case 'attributes': // å±¬æ€§è®Šæ›´ï¼ˆä¾‹å¦‚ classï¼‰
                            log.textContent = 'ðŸ”„ Class attribute changed';
                            break;
                        case 'characterData': // æ–‡å­—ç¯€é»žå…§å®¹è®Šæ›´
                            log.textContent = 'âœï¸ Text content modified';
                            break;
                    }

                    // å°‡ log æ’å…¥åˆ°ç´€éŒ„å€æœ€å‰é¢
                    observerLog.prepend(log);
                });
            });
// å•Ÿå‹•ç›£è½ï¼Œè¨­å®šç›£æŽ§é …ç›®
            observer.observe(observerTarget, {
                childList: true,//ç›£æŽ§å­ç¯€é»žæ–°å¢ž/ç§»é™¤
                attributes: true,// ç›£æŽ§å±¬æ€§è®Šæ›´ï¼ˆå¦‚ class
                characterData: true,// ç›£æŽ§æ–‡å­—ç¯€é»žå…§å®¹è®Šæ›´
                subtree: true// åŒ…å«æ‰€æœ‰å­å…ƒç´ çš„è®ŠåŒ–
            });
// é»žæ“Šå¾Œæ–°å¢žä¸€å€‹å­ç¯€é»žï¼Œè§¸ç™¼ childList è®ŠåŒ–
            addChildBtn.addEventListener('click', () => {
                const child = document.createElement('div');
                child.textContent = 'New Child';
                observerTarget.appendChild(child);
            });
// é»žæ“Šå¾Œåˆ‡æ› classï¼Œè§¸ç™¼ attributes è®ŠåŒ–
            changeClassBtn.addEventListener('click', () => {
                observerTarget.classList.toggle('highlighted');
            });
// é»žæ“Šå¾Œä¿®æ”¹æ–‡å­—ç¯€é»žå…§å®¹ï¼Œè§¸ç™¼ characterData è®ŠåŒ–
            modifyTextBtn.addEventListener('click', () => {
                if (observerTarget.firstChild.nodeType === Node.TEXT_NODE) {
                    observerTarget.firstChild.textContent = 'Modified Text: ' + new Date().toLocaleTimeString();
                }
            });
        });
    </script>
</body>

</html>
